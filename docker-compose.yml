version: '3.8'

services:
  # ============================================
  # EVOLUTION API (WhatsApp Gateway)
  # ============================================
  evolution-api:
    image: atendai/evolution-api:latest
    container_name: evolution-api
    ports:
      - "8081:8080"
    environment:
      # Autenticação
      - AUTHENTICATION_API_KEY=${EVOLUTION_API_KEY:-your_evolution_api_key_here}
      
      # Database (desabilitado para MVP - usa armazenamento local)
      - DATABASE_ENABLED=false
      
      # Webhook
      - WEBHOOK_GLOBAL_ENABLED=true
      - WEBHOOK_GLOBAL_URL=${WEBHOOK_URL:-http://host.docker.internal:8080/webhook/whatsapp}
      - WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS=true
      
      # QR Code
      - QRCODE_LIMIT=30
      
      # Logs
      - LOG_LEVEL=INFO
      - LOG_COLOR=true
      
    volumes:
      - evolution_instances:/evolution/instances
      - evolution_store:/evolution/store
    
    networks:
      - ai-health-network
    
    restart: unless-stopped

  # ============================================
  # POSTGRESQL (Opcional - se não usar Supabase)
  # ============================================
  postgres:
    image: postgres:16-alpine
    container_name: ai-health-postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_DB=ai_health_agent
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=${DATABASE_PASSWORD:-postgres}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - ai-health-network
    restart: unless-stopped

volumes:
  evolution_instances:
    driver: local
  evolution_store:
    driver: local
  postgres_data:
    driver: local

networks:
  ai-health-network:
    driver: bridge

